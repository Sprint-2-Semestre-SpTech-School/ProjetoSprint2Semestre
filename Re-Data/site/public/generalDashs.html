<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Geral</title>
    <link rel="stylesheet" href="./css/generalDashs.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body onload="buscarMaquinasAtivas(), buscarTempoOpTotal()">
    <main>
        <section>
            <nav class="navbar">
                <div class="user">
                    <img src="./assets/icon/Logo High.png" alt="">
                    <i class="fas fa-user-lock"></i>
                </div>
                <div class="meeting">
                    <h1>Bem-vindo(a)!</h1>
                    <h1 id="data"></h1>
                    <h1 id="time"></h1>
                </div>
                <ul class="nav-items">
                    <li class="item">
                        <!-- Nossos Serviços -->
                        <i class="fas fa-envelope"></i>
                    </li>
                    <a class="itemLink" href="Dash Panel.html">
                        <li class="itemLink">
                            <!-- Home -->
                            <i class="fas fa-house-user"></i>
                        </li>
                    </a>
                    <a class="itemLink" href="login.html">
                        <li class="itemLink">
                            <!-- Sair -->
                            <i class="fas fa-sign-out-alt"></i>
                        </li>
                    </a>
                </ul>
            </nav>
            <div class="content">
                <div class="info">
                    <div id="div_maquinasAtivas" class="kpi">
                        <h1>Máquinas ativas: 27</h1>
                    </div>
                    <div id="div_tempoOpTotal" class="kpi">
                        <h1>
                            Tempo de operação total: 120h
                        </h1>
                    </div>
                    <!-- <div class="kpi">
                        <h1>
                            Eficiência: 33%
                        </h1>
                    </div>
                    <div class="kpi">
                        <h1>
                            33% do disco de 512
                        </h1>
                    </div> -->
                    <div class="select-project">
                        <select name="" id="">
                            <option value="">Projeto 1</option>
                            <option value="">Projeto 2</option>
                            <option value="">Projeto 3</option>
                        </select>
                    </div>
                </div>
                <div class="dash-view">
                    <div class="group">
                        <div class="dashboard">
                            <canvas id="myChart1"></canvas>
                        </div>
                        <div class="dashboard">
                            <canvas id="myChart2"></canvas>
                        </div>
                    </div>
                    <div class="group">
                        <div class="dashboard">
                            <canvas id="myChart3"></canvas>
                        </div>
                        <div class="dashboard">
                            <canvas id="myChart4"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</body>

</html>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="./js/dashConstruction.js"></script>

<script>

    var idProjeto = sessionStorage.ID_USUARIO;

    console.log(idProjeto);

    function buscarMaquinasAtivas() {
        console.log('Esse é o projeto ' + idProjeto)
        // function buscarMaquinasAtivas() {
        console.log(idProjeto)
        fetch(`/dashboard/buscarMaquinasAtivas/${idProjeto}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(function (resposta) {
                console.log("Dados recebidos: ", JSON.stringify(resposta));
                resposta.json()
                    .then((json) => {
                        console.log(json);
                        console.log(json[0].qtd);

                        var qtsMaquinas = json[0].qtdMaquinas
                        console.log(qtsMaquinas);

                        var qtdTotal = document.getElementById("div_maquinasAtivas")
                        qtdTotal.innerHTML = `<b>Máquinas ativas: ${qtsMaquinas}</b>`;
                        console.log(qtdTotal);

                    })
            })


            .catch(function (erro) {
                console.error('Erro desconhecido na API.');
            }
            );
        // }
    }

    function buscarTempoOpTotal() {
        console.log('Esse é o projeto do tempo' + idProjeto)
        // function buscarTempoOpTotal() {
        console.log(idProjeto + ' tempo')
        fetch(`/dashboard/buscarTempoOpTotal/${idProjeto}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(function (resposta) {
                console.log("Dados recebidos do tempo total: ", JSON.stringify(resposta));
                resposta.json()
                    .then((json) => {
                        console.log(json);
                        console.log(json[0].qtd);

                        var qtsHoras = json[0].tempoOpTotal
                        console.log(qtsHoras);

                        var horasTotais = document.getElementById("div_tempoOpTotal")
                        horasTotais.innerHTML = `<b>Tempo de operação total: ${qtsHoras}h</b>`;
                        console.log(horasTotais);

                    })
            })


            .catch(function (erro) {
                console.error('Erro desconhecido na API.');
            }
            );
        // }
    }

    // window.onload = function () {
    //     buscarMaquinasAtivas;
    // };

</script>